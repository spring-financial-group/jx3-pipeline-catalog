apiVersion: tekton.dev/v1beta1
kind: PipelineRun
metadata:
  creationTimestamp: null
  name: pullrequest
spec:
  pipelineSpec:
    tasks:
    - name: git-clone-pr
      taskRef:
        params:
        - name: url
          value: https://github.com/spring-financial-group/jx3-pipeline-catalog.git
        - name: revision
          value: master
        - name: pathInRepo
          value: tasks/git-clone/git-clone-pr.yaml
        resolver: git
      workspaces:
      - name: output
        workspace: pipeline-ws
    - name: next-version
      runAfter:
      - git-clone-pr
      taskRef:
        params:
        - name: url
          value: https://github.com/spring-financial-group/jx3-pipeline-catalog.git
        - name: revision
          value: a5ab19ebc5a074e0402c5016b11bc11b32cc5c83
        - name: pathInRepo
          value: tasks/go/release/next-version.yaml
        resolver: git
      workspaces:
      - name: output
        workspace: pipeline-ws
    - name: jx-variables
      runAfter:
      - next-version
      taskRef:
        params:
        - name: url
          value: https://github.com/spring-financial-group/jx3-pipeline-catalog.git
        - name: revision
          value: a5ab19ebc5a074e0402c5016b11bc11b32cc5c83
        - name: pathInRepo
          value: tasks/go/release/jx-variables.yaml
        resolver: git
      workspaces:
      - name: output
        workspace: pipeline-ws
    - name: runci
      runAfter:
      - jx-variables
      taskSpec:
        metadata: {}
        spec: null
        stepTemplate:
          name: ""
          resources: {}
          workingDir: /workspace/source
        steps:
        - env:
          - name: GH_ACCESS_TOKEN
            valueFrom:
              secretKeyRef:
                key: password
                name: bdd-git
          image: ghcr.io/jenkins-x/jx-go-maven:3.2.197
          name: runci
          resources: {}
          script: |
            #!/usr/bin/env bash
            source .jx/variables.sh
            echo running bdd test $JOB_NAME
            cd /workspace/source/.lighthouse/jenkins-x/tests
            go mod download
            make test
        workspaces:
        - description: The workspace used to store the cloned git repository and the
            generated files
          mountPath: /workspace
          name: output
  workspaces:
  - name: pipeline-ws
    volumeClaimTemplate:
      metadata:
        creationTimestamp: null
      spec:
        accessModes:
        - ReadWriteOnce
        resources:
          requests:
            storage: 1Gi
      status: {}
status: {}
